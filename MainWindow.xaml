<ui:FluentWindow
    x:Class="Mercury.MainWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:converters="clr-namespace:Mercury.Models.Converters"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:local="clr-namespace:Mercury"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:models="clr-namespace:Mercury.Models"
    xmlns:pages="clr-namespace:Mercury.Views.Pages"
    xmlns:sys="clr-namespace:System;assembly=mscorlib"
    xmlns:tray="http://schemas.lepo.co/wpfui/2022/xaml/tray"
    xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
    xmlns:vlc="clr-namespace:LibVLCSharp.WPF;assembly=LibVLCSharp.WPF"
    xmlns:youtube="clr-namespace:YouTubeApi;assembly=YouTubeApi"
    Name="Window"
    Title="Mercury"
    Width="800"
    Height="450"
    MinWidth="600"
    MinHeight="240"
    ui:Design.Background="{DynamicResource ApplicationBackgroundBrush}"
    ExtendsContentIntoTitleBar="True"
    PreviewKeyDown="Window_PreviewKeyDown"
    WindowBackdropType="Mica"
    WindowStyle="None"
    mc:Ignorable="d">
    <ui:FluentWindow.Resources>
        <converters:MultiValueConverter x:Key="MultiValueConverter" />
    </ui:FluentWindow.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="*" />
            <RowDefinition Height="76" />
        </Grid.RowDefinitions>

        <tray:NotifyIcon Icon="/Assets/Icon.png" MenuFontSize="6">
            <tray:NotifyIcon.Menu>
                <ContextMenu>
                    <ui:MenuItem
                        Command="{Binding ShowWindowCommand}"
                        Header="Show Mercury"
                        Icon="{ui:SymbolIcon Symbol=Add32}" />
                    <Separator />
                    <ui:MenuItem Header="Settings" Icon="{ui:SymbolIcon Symbol=Settings32}" />
                    <Separator />
                    <ui:MenuItem
                        Command="{Binding KillWindowCommand}"
                        Header="Exit Mercury">
                        <ui:MenuItem.Icon>
                            <ui:SymbolIcon Symbol="Add32" Margin="-4">
                                <ui:SymbolIcon.LayoutTransform>
                                    <RotateTransform Angle="45" />
                                </ui:SymbolIcon.LayoutTransform>
                            </ui:SymbolIcon>
                        </ui:MenuItem.Icon>
                    </ui:MenuItem>
                </ContextMenu>
            </tray:NotifyIcon.Menu>
        </tray:NotifyIcon>

        <ui:TitleBar
            Name="TitleBar"
            Title="Mercury"
            Grid.Row="0"
            HorizontalContentAlignment="Stretch"
            CloseWindowByDoubleClickOnIcon="True">
            <ui:TitleBar.Icon>
                <ui:ImageIcon RenderOptions.BitmapScalingMode="HighQuality" Source="/Assets/Icon.png" />
            </ui:TitleBar.Icon>
            <ui:TitleBar.CenterContent>
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="4*" />
                        <ColumnDefinition Width="*" />
                    </Grid.ColumnDefinitions>
                    <Grid Grid.Column="1">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="Auto" />
                        </Grid.ColumnDefinitions>
                        <ui:TextBox
                            Grid.Column="0"
                            Margin="0,6"
                            VerticalAlignment="Stretch"
                            BorderBrush="{DynamicResource ControlStrokeColorSecondaryBrush}"
                            BorderThickness="1,1,0,1"
                            Icon="{ui:SymbolIcon Symbol=Search24,
                                                 FontSize=16}"
                            PlaceholderText="Search songs, artist..."
                            Text="{Binding SearchText, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}">
                            <ui:TextBox.Resources>
                                <CornerRadius x:Key="ControlCornerRadius">6,0,0,6</CornerRadius>
                            </ui:TextBox.Resources>
                        </ui:TextBox>
                        <ComboBox
                            Grid.Column="1"
                            Margin="0,6"
                            VerticalAlignment="Stretch"
                            BorderBrush="{DynamicResource ControlStrokeColorSecondaryBrush}"
                            BorderThickness="0,1,1,1"
                            ItemsSource="{Binding SearchFilters}"
                            SelectedValue="{Binding SearchFilter}">
                            <ComboBox.Resources>
                                <CornerRadius x:Key="ControlCornerRadius">0,6,6,0</CornerRadius>
                            </ComboBox.Resources>
                        </ComboBox>
                    </Grid>
                </Grid>
            </ui:TitleBar.CenterContent>
        </ui:TitleBar>

        <vlc:VideoView Name="VideoView" Visibility="Collapsed" />

        <ui:NavigationView
            Name="NavView"
            BreadcrumbBar="{Binding ElementName=BreadcrumbBar}"
            IsBackButtonVisible="Visible"
            IsFooterSeparatorVisible="False"
            IsPaneOpen="False"
            IsPaneToggleVisible="False"
            IsTopSeparatorVisible="False"
            PaneDisplayMode="Left"
            TitleBar="{Binding ElementName=TitleBar, Mode=OneWay}">
            <ui:NavigationView.MenuItems>
                <ui:NavigationViewItem
                    Icon="{ui:SymbolIcon Symbol=Search24}"
                    NavigationCacheMode="Required"
                    TargetPageType="{x:Type pages:SearchView}" />
                <ui:NavigationViewItem
                    Icon="{ui:SymbolIcon Symbol=MusicNote124}"
                    NavigationCacheMode="Required"
                    TargetPageType="{x:Type pages:SongView}" />
            </ui:NavigationView.MenuItems>
        </ui:NavigationView>

        <Border
            Name="HudBorder"
            Grid.Row="1"
            Background="{DynamicResource ControlFillColorTertiaryBrush}"
            BorderBrush="{DynamicResource ControlStrokeColorDefaultBrush}"
            BorderThickness="2,2,2,0"
            CornerRadius="6,6,0,0">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="2*" />
                    <ColumnDefinition Width="*" />
                </Grid.ColumnDefinitions>
                <Grid.RowDefinitions>
                    <RowDefinition Height="24" />
                    <RowDefinition Height="*" />
                </Grid.RowDefinitions>

                <Grid
                    Grid.RowSpan="2"
                    Grid.Column="0"
                    Visibility="{Binding CurrentPlayingVisibility, FallbackValue=Collapsed}">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="*" />
                    </Grid.ColumnDefinitions>
                    <Border
                        Grid.Column="0"
                        Width="{Binding ActualHeight, RelativeSource={RelativeSource Self}}"
                        Margin="8"
                        HorizontalAlignment="Left"
                        VerticalAlignment="Stretch"
                        BorderBrush="{DynamicResource ControlStrokeColorDefaultBrush}"
                        BorderThickness="2"
                        ClipToBounds="True"
                        CornerRadius="6">
                        <Border.Background>
                            <ImageBrush
                                ImageSource="{Binding CurrentSong.Media.Thumbnails.MediumResUrl}"
                                RenderOptions.BitmapScalingMode="HighQuality"
                                Stretch="UniformToFill" />
                        </Border.Background>
                    </Border>

                    <StackPanel Grid.Column="1">
                        <TextBlock
                            Margin="4,4,4,0"
                            FontSize="16"
                            Foreground="{DynamicResource TextFillColorPrimaryBrush}"
                            Text="{Binding CurrentSong.Title, FallbackValue=Title}" />
                        <TextBlock
                            Margin="4,0"
                            FontSize="14"
                            Foreground="{DynamicResource TextFillColorTertiaryBrush}"
                            Text="{Binding CurrentSong.Artist, FallbackValue=Artist}" />
                    </StackPanel>
                </Grid>

                <Grid
                    Grid.Row="0"
                    Grid.Column="1"
                    Margin="6,4,6,0">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>
                    <TextBlock
                        Grid.Column="0"
                        VerticalAlignment="Center"
                        Text="{Binding CurrentProgress, FallbackValue=0:00}" />
                    <Slider
                        Name="PosSlider"
                        Grid.Column="1"
                        Margin="4,0,4,0"
                        VerticalAlignment="Top"
                        IsTabStop="False"
                        LargeChange="0"
                        Maximum="1"
                        Minimum="0"
                        Thumb.DragCompleted="PosSlider_DragCompleted"
                        Thumb.DragStarted="PosSlider_DragStarted"
                        Value="{Binding SongProgress, Mode=TwoWay}" />
                    <TextBlock
                        Grid.Column="2"
                        VerticalAlignment="Center"
                        Text="{Binding CurrentSong.FormatedDurarion, FallbackValue=0:00}" />
                </Grid>

                <Grid Grid.Row="1" Grid.Column="1">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>

                    <ui:Button
                        Name="MediaContinueButton"
                        Grid.Column="0"
                        Width="{Binding ActualHeight, RelativeSource={RelativeSource Self}}"
                        Margin="6"
                        Padding="0"
                        HorizontalAlignment="Center"
                        VerticalAlignment="Stretch"
                        Appearance="Secondary"
                        Background="Transparent"
                        BorderThickness="0"
                        Command="{Binding SwtichRepeatCommand}"
                        Icon="{Binding RepeatButtonIcon, FallbackValue={ui:SymbolIcon Symbol=ArrowRepeat124, FontSize=24}}"
                        MouseOverBackground="{DynamicResource SubtleFillColorTertiaryBrush}"
                        PressedForeground="{DynamicResource TextFillColorPrimaryBrush}" />
                    <ui:Button
                        Name="MediaPreviousButton"
                        Grid.Column="2"
                        Width="{Binding ActualHeight, RelativeSource={RelativeSource Self}}"
                        Margin="6"
                        Padding="0"
                        HorizontalAlignment="Center"
                        VerticalAlignment="Stretch"
                        Appearance="Secondary"
                        Background="Transparent"
                        BorderThickness="0"
                        Command="{Binding PlayPreviousCommand}"
                        Icon="{ui:SymbolIcon Symbol=Previous24,
                                             FontSize=24}"
                        MouseOverBackground="{DynamicResource SubtleFillColorTertiaryBrush}"
                        PressedForeground="{DynamicResource TextFillColorPrimaryBrush}" />
                    <ui:Button
                        Name="MediaPlayButton"
                        Grid.Column="3"
                        Width="{Binding ActualHeight, RelativeSource={RelativeSource Self}}"
                        Margin="6"
                        Padding="0"
                        HorizontalAlignment="Center"
                        VerticalAlignment="Stretch"
                        Appearance="Secondary"
                        Background="Transparent"
                        BorderThickness="0"
                        Command="{Binding TogglePlayCommand}"
                        Icon="{Binding PlayButtonIcon, FallbackValue={ui:SymbolIcon Symbol=Play24, FontSize=24}}"
                        MouseOverBackground="{DynamicResource SubtleFillColorTertiaryBrush}"
                        PressedForeground="{DynamicResource TextFillColorPrimaryBrush}" />
                    <ui:Button
                        Name="MediaNextButton"
                        Grid.Column="4"
                        Width="{Binding ActualHeight, RelativeSource={RelativeSource Self}}"
                        Margin="6"
                        Padding="0"
                        HorizontalAlignment="Center"
                        VerticalAlignment="Stretch"
                        Background="Transparent"
                        BorderThickness="0"
                        Command="{Binding PlayNextCommand}"
                        Icon="{ui:SymbolIcon Symbol=Next24,
                                             FontSize=24}"
                        MouseOverBackground="{DynamicResource SubtleFillColorTertiaryBrush}"
                        PressedForeground="{DynamicResource TextFillColorPrimaryBrush}" />
                    <ui:Button
                        Name="MediaVolumeButton"
                        Grid.Column="6"
                        Width="{Binding ActualHeight, RelativeSource={RelativeSource Self}}"
                        Margin="6"
                        Padding="0"
                        HorizontalAlignment="Center"
                        VerticalAlignment="Stretch"
                        Background="Transparent"
                        BorderThickness="0"
                        Click="MediaVolumeButton_Click"
                        Icon="{Binding VolumeIcon, FallbackValue={ui:SymbolIcon Symbol=Speaker024, FontSize=24}}"
                        MouseOverBackground="{DynamicResource SubtleFillColorTertiaryBrush}"
                        PressedForeground="{DynamicResource TextFillColorPrimaryBrush}" />

                    <Popup
                        Name="VolumePopup"
                        Grid.Column="6"
                        AllowsTransparency="True"
                        Placement="Top"
                        PlacementTarget="{Binding ElementName=MediaVolumeButton}"
                        PopupAnimation="Slide"
                        StaysOpen="False">
                        <Border
                            Margin="0,0,0,8"
                            Padding="16"
                            Background="{DynamicResource ApplicationBackgroundBrush}"
                            BorderBrush="{DynamicResource ControlStrokeColorDefaultBrush}"
                            BorderThickness="1"
                            CornerRadius="8">
                            <Border.Effect>
                                <DropShadowEffect
                                    BlurRadius="12"
                                    Opacity="0.1"
                                    RenderingBias="Quality"
                                    ShadowDepth="2"
                                    Color="Black" />
                            </Border.Effect>
                            <StackPanel Orientation="Horizontal">
                                <Slider
                                    Name="VolumeSlider"
                                    Width="120"
                                    Height="20"
                                    HorizontalAlignment="Center"
                                    IsSnapToTickEnabled="True"
                                    Maximum="100"
                                    Minimum="0"
                                    TickFrequency="1"
                                    Value="{Binding Volume, Mode=TwoWay}" />
                                <TextBlock
                                    MinWidth="40"
                                    Margin="4,0,0,0"
                                    VerticalAlignment="Center"
                                    FontWeight="SemiBold"
                                    Text="{Binding Volume, StringFormat={}{0}%}" />

                            </StackPanel>
                        </Border>
                    </Popup>
                </Grid>
            </Grid>
        </Border>
    </Grid>
</ui:FluentWindow>
